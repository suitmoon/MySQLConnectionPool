# MySQLConnectionPool


 这是MySQLConnectionPool的最新版本。如果你想查看老版本的文件，你可以进入`Old_Version`文件夹。老版本在linux上运行存在死锁问题，原因是并未实现pool的具体析构，而在pool实例化时候创建一个新的线程作为连接的生产者，std::thread produce一个新的定时线程对于空闲连接的回收，并且都分离了，但并未设置退出条件。而在win上运行正常，这是因为在Windows中，当主线程结束时，所有的子线程会被自动结束。然而，在Linux中，当主线程结束时，它并不会自动结束所有的子线程。

# 如在win上运行，在VS上需要进行的配置如下：  
  
1. 右键你的项目 -> 属性 -> C/C++ -> 常规 -> 附加包含目录，然后填写mysql.h头文件的路径。  
2. 右键你的项目 -> 属性 -> 链接器 -> 常规 -> 附加库目录，然后填写libmysql.lib的路径。  
3. 右键你的项目 -> 属性 -> 链接器 -> 输入 -> 附加依赖项，然后填写libmysql.lib库的名字。  
4. 把libmysql.dll动态链接库放在你的工程目录下。



# 压力测试结果
### 数据库连接池性能对比(win平台)
| 数据量 | 未使用连接池花费时间（ms） | 使用连接池花费时间（ms） |
| ------ | ------------------------ | ----------------------- |
| 1000   | 单线程：2126ms           | 单线程：2012ms           |
|        | 四线程：1043ms            | 四线程：1013ms           |
| 5000   | 单线程：10479ms          | 单线程：7077ms          |
|        | 四线程：5143ms           | 四线程：3532ms           |
| 10000  | 单线程：21395ms          | 单线程：20131ms          |
|        | 四线程：10180ms           | 四线程：10084ms           |


### 数据库连接池性能对比(Linux平台)
| 数据量 | 未使用连接池花费时间（ms） | 使用连接池花费时间（ms） |
| ------ | ------------------------ | ----------------------- |
| 1000   | 单线程：2823ms           | 单线程：266ms           |
|        | 四线程：753ms            | 四线程：122ms           |
| 5000   | 单线程：12833ms          | 单线程：1153ms          |
|        | 四线程：3323ms           | 四线程：458ms           |
| 10000  | 单线程：25869ms          | 单线程：2353ms          |
|        | 四线程：6340ms           | 四线程：887ms           |

# 总结  
- **MySQL在Linux下的性能通常比Windows下的性能更好**。  
- **mysql_init()不是线程安全的，但只要成功调用一次就后就线程安全了，多线程并发使用mysql_init()情况下，需在程序初始化时空调一次mysql_init()**。  
- **数据库连接池能明显提高对数据库操作的性能和效率**。


